<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Technique - gogoleform</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 11pt;
            line-height: 1.6;
            color: #000;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: white;
        }
        
        h1 {
            color: #000;
            font-size: 24pt;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
            margin-top: 20px;
        }
        
        h2 {
            color: #000;
            font-size: 18pt;
            margin-top: 30px;
            margin-bottom: 10px;
        }
        
        h3 {
            color: #000;
            font-size: 14pt;
            margin-top: 20px;
            margin-bottom: 8px;
        }
        
        h4 {
            color: #000;
            font-size: 12pt;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        p {
            margin: 10px 0;
        }
        
        ul, ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 5px 0;
        }
        
        code {
            background-color: #f5f5f5;
            padding: 2px 5px;
            font-family: 'Courier New', monospace;
            font-size: 10pt;
        }
        
        pre {
            background-color: #f5f5f5;
            border: 1px solid #ccc;
            padding: 10px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 10pt;
            line-height: 1.4;
        }
        
        pre code {
            background: none;
            padding: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th {
            background-color: #ddd;
            padding: 8px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #999;
        }
        
        td {
            padding: 8px;
            border: 1px solid #ccc;
        }
        
        .toc {
            background-color: #f5f5f5;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #ccc;
        }
        
        .toc h2 {
            margin-top: 0;
        }
        
        .toc ul {
            list-style-type: decimal;
        }
        
        .info-box, .warning-box, .success-box {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 15px 0;
            background-color: #f9f9f9;
        }
        
        .diagram {
            background-color: #f5f5f5;
            padding: 10px;
            border: 1px solid #ccc;
            font-family: 'Courier New', monospace;
            font-size: 9pt;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .section-divider {
            border-top: 1px solid #ccc;
            margin: 30px 0;
        }
    </style>
</head>
<body>

<h1>Documentation Technique - gogoleform</h1>

<p><strong>Version :</strong> 1.0.0<br>
<strong>Dernière mise à jour :</strong> 29 décembre 2025</p>

<div class="toc">
    <h2>Table des matières</h2>
    <ul>
        <li><a href="#vue-ensemble">1. Vue d'ensemble</a></li>
        <li><a href="#architecture">2. Architecture</a></li>
        <li><a href="#base-donnees">3. Base de données</a></li>
        <li><a href="#api-backend">4. API Backend (PHP)</a></li>
        <li><a href="#frontend">5. Frontend</a></li>
        <li><a href="#securite">6. Sécurité</a></li>
        <li><a href="#installation">7. Installation & Configuration</a></li>
        <li><a href="#flux-donnees">8. Flux de données</a></li>
        <li><a href="#guide-dev">9. Guide de développement</a></li>
    </ul>
</div>

<div class="section-divider"></div>

<h2 id="vue-ensemble">1. Vue d'ensemble</h2>

<p><strong>gogoleform</strong> est une application web de gestion de sondages inspirée de Google Forms. Elle permet aux utilisateurs de créer des comptes, authentifier, créer des questionnaires avec différents types de questions, répondre à des sondages, et visualiser les résultats avec graphiques et statistiques.</p>

<h3>Fonctionnalités principales</h3>

<ul>
    <li><strong>Authentification complète</strong> - Inscription, connexion, déconnexion avec mots de passe hachés</li>
    <li><strong>Création de sondages</strong> - Interface dynamique avec 3 types de questions</li>
    <li><strong>Types de questions :</strong> Texte libre, Choix multiple, Échelle (0-10)</li>
    <li><strong>Questions anonymes</strong> - Option pour masquer l'identité des répondants</li>
    <li><strong>Visualisation des résultats</strong> - Graphiques en camembert et calcul de moyennes</li>
    <li><strong>Export des données</strong> - CSV (UTF-8 avec BOM) et PDF</li>
    <li><strong>Partage de sondages</strong> - Système de permissions (view/answer/admin)</li>
    <li><strong>Protection anti-bruteforce</strong> - Limitation des tentatives de connexion</li>
</ul>

<h3>Technologies utilisées</h3>

<table>
    <tr>
        <th>Catégorie</th>
        <th>Technologie</th>
        <th>Version</th>
    </tr>
    <tr>
        <td>Frontend</td>
        <td>HTML5, CSS3, JavaScript (Vanilla)</td>
        <td>-</td>
    </tr>
    <tr>
        <td>Backend</td>
        <td>PHP</td>
        <td>8.x</td>
    </tr>
    <tr>
        <td>Base de données</td>
        <td>MySQL / MariaDB</td>
        <td>10.4+</td>
    </tr>
    <tr>
        <td>Framework CSS</td>
        <td>Bootstrap</td>
        <td>5.3.2</td>
    </tr>
    <tr>
        <td>Graphiques</td>
        <td>Chart.js</td>
        <td>4.4.0</td>
    </tr>
    <tr>
        <td>Export PDF</td>
        <td>html2pdf.js</td>
        <td>0.10.1</td>
    </tr>
</table>

<div class="section-divider"></div>

<h2 id="architecture">2. Architecture</h2>

<h3>Structure des dossiers</h3>

<pre><code>google-form/
├── html/                   # Pages HTML
│   ├── index.html          # Page de connexion
│   ├── register.html       # Page d'inscription
│   ├── home.html           # Liste des sondages
│   ├── create_survey.html  # Création de sondages
│   ├── questions.html      # Répondre aux questions
│   ├── answer.html         # Visualisation des réponses
│   ├── share_survey.html   # Partage de sondages
│   └── navbar.html         # Navbar réutilisable
├── js/                     # Scripts JavaScript
│   ├── script.js           # Authentification (login)
│   ├── register.js         # Inscription
│   ├── home.js             # Liste des sondages
│   ├── create_survey.js    # Création dynamique
│   ├── questions.js        # Affichage et soumission
│   ├── answer.js           # Visualisation et export
│   ├── share_survey.js     # Gestion du partage
│   └── navbar.js           # Navbar dynamique
├── php/                    # API Backend
│   ├── login_check.php     # Authentification
│   ├── register.php        # Inscription
│   ├── create_survey.php   # Création de sondages
│   └── ... (12 endpoints)
├── sql/                    # Scripts SQL
├── style.css               # Styles personnalisés
└── logo.png                # Logo de l'application</code></pre>

<h3>Architecture MVC implicite</h3>

<table>
    <tr>
        <th>Composant</th>
        <th>Rôle</th>
        <th>Technologies</th>
    </tr>
    <tr>
        <td><strong>Modèle</strong></td>
        <td>Gestion des données</td>
        <td>PHP + MySQL</td>
    </tr>
    <tr>
        <td><strong>Vue</strong></td>
        <td>Interface utilisateur</td>
        <td>HTML + CSS + Bootstrap</td>
    </tr>
    <tr>
        <td><strong>Contrôleur</strong></td>
        <td>Logique métier</td>
        <td>JavaScript (client) + PHP (serveur)</td>
    </tr>
</table>

<div class="section-divider"></div>

<h2 id="base-donnees">3. Base de données</h2>

<h3>Schéma relationnel</h3>

<h4>Table <code>user</code></h4>
<p>Stocke les utilisateurs de l'application.</p>

<pre><code>CREATE TABLE `user` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `username` VARCHAR(50) UNIQUE NOT NULL,
  `password` VARCHAR(255) NOT NULL,  -- Hash bcrypt
  `email` VARCHAR(100)
);</code></pre>

<table>
    <tr>
        <th>Champ</th>
        <th>Type</th>
        <th>Description</th>
    </tr>
    <tr>
        <td><code>id</code></td>
        <td>INT</td>
        <td>Identifiant unique</td>
    </tr>
    <tr>
        <td><code>username</code></td>
        <td>VARCHAR(50)</td>
        <td>Nom d'utilisateur unique</td>
    </tr>
    <tr>
        <td><code>password</code></td>
        <td>VARCHAR(255)</td>
        <td>Mot de passe haché avec <code>password_hash()</code></td>
    </tr>
    <tr>
        <td><code>email</code></td>
        <td>VARCHAR(100)</td>
        <td>Adresse email (optionnel)</td>
    </tr>
</table>

<h4>Table <code>form</code></h4>
<p>Représente les sondages/formulaires créés.</p>

<pre><code>CREATE TABLE `form` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `title` VARCHAR(255) NOT NULL,
  `description` TEXT,
  `user_id` INT,
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`)
);</code></pre>

<h4>Table <code>question</code></h4>
<p>Questions d'un formulaire avec leur type.</p>

<pre><code>CREATE TABLE `question` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `form_id` INT NOT NULL,
  `question_text` TEXT NOT NULL,
  `type` VARCHAR(20) DEFAULT 'text',  -- 'text', 'multiple', 'scale'
  `anonymus` TINYINT(1) DEFAULT 0,    -- 0 = non anonyme, 1 = anonyme
  FOREIGN KEY (`form_id`) REFERENCES `form`(`id`)
);</code></pre>

<div class="info-box">
    <strong>Types de questions supportés :</strong>
    <ul>
        <li><code>text</code> : Texte libre (textarea)</li>
        <li><code>multiple</code> : Choix multiples avec checkboxes</li>
        <li><code>scale</code> : Échelle de notation (0-10)</li>
    </ul>
</div>

<h4>Table <code>question_option</code></h4>
<p>Options pour les questions à choix multiples.</p>

<pre><code>CREATE TABLE `question_option` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `question_id` INT NOT NULL,
  `option_text` VARCHAR(255) NOT NULL,
  FOREIGN KEY (`question_id`) REFERENCES `question`(`id`) ON DELETE CASCADE
);</code></pre>

<h4>Table <code>answer</code></h4>
<p>Réponses aux questions.</p>

<pre><code>CREATE TABLE `answer` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `question_id` INT NOT NULL,
  `user_id` INT,
  `answer_text` TEXT NOT NULL,
  `answered_at` DATETIME DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (`question_id`) REFERENCES `question`(`id`),
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`)
);</code></pre>

<div class="info-box">
    <strong>Format de answer_text selon le type :</strong>
    <ul>
        <li><strong>Type text</strong> : Texte libre</li>
        <li><strong>Type multiple</strong> : Valeurs séparées par virgule (ex: "Option 1, Option 3")</li>
        <li><strong>Type scale</strong> : Nombre de 0 à 10 (ex: "7")</li>
    </ul>
</div>

<h4>Table <code>survey_access</code></h4>
<p>Gestion des permissions de partage.</p>

<pre><code>CREATE TABLE `survey_access` (
  `id` INT PRIMARY KEY AUTO_INCREMENT,
  `form_id` INT NOT NULL,
  `user_id` INT NOT NULL,
  `access_type` ENUM('view','answer','admin') DEFAULT 'answer',
  UNIQUE KEY (`form_id`, `user_id`),
  FOREIGN KEY (`form_id`) REFERENCES `form`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`user_id`) REFERENCES `user`(`id`) ON DELETE CASCADE
);</code></pre>

<table>
    <tr>
        <th>Type d'accès</th>
        <th>Permissions</th>
    </tr>
    <tr>
        <td><code>view</code></td>
        <td>Voir les résultats uniquement</td>
    </tr>
    <tr>
        <td><code>answer</code></td>
        <td>Répondre au sondage</td>
    </tr>
    <tr>
        <td><code>admin</code></td>
        <td>Gérer le sondage</td>
    </tr>
</table>

<h4>Table <code>login_attempts</code></h4>
<p>Protection anti-bruteforce.</p>

<pre><code>CREATE TABLE `login_attempts` (
  `ip` VARCHAR(45) PRIMARY KEY,
  `attempts` INT DEFAULT 0,
  `last_attempt` DATETIME DEFAULT CURRENT_TIMESTAMP,
  `locked_until` DATETIME
);</code></pre>

<div class="info-box">
    <strong>Logique de sécurité :</strong>
    <ul>
        <li>Après 5 tentatives échouées → blocage de 15 minutes</li>
        <li>Réinitialisation après connexion réussie</li>
    </ul>
</div>

<div class="section-divider"></div>

<h2 id="api-backend">4. API Backend (PHP)</h2>

<p>Tous les endpoints renvoient du JSON et incluent des headers CORS.</p>

<h3>4.1 Authentification</h3>

<h4><code>POST /php/login_check.php</code></h4>
<p>Authentifie un utilisateur.</p>

<p><strong>Requête :</strong></p>
<pre><code>{
  "username": "admin",
  "password": "motdepasse"
}</code></pre>

<p><strong>Réponse (succès) :</strong></p>
<pre><code>{
  "success": true,
  "user": {
    "id": 1,
    "username": "admin"
  }
}</code></pre>

<p><strong>Réponse (erreur) :</strong></p>
<pre><code>{
  "success": false,
  "error": "Utilisateur ou mot de passe incorrect."
}</code></pre>

<div class="info-box">
    <strong>Sécurité :</strong>
    <ul>
        <li>Vérification anti-bruteforce</li>
        <li>Mot de passe vérifié avec <code>password_verify()</code></li>
        <li>Blocage IP après 5 tentatives échouées</li>
    </ul>
</div>

<h4><code>POST /php/register.php</code></h4>
<p>Crée un nouveau compte utilisateur.</p>

<p><strong>Requête :</strong></p>
<pre><code>{
  "username": "nouvel_utilisateur",
  "password": "motdepasse",
  "email": "email@example.com"
}</code></pre>

<p><strong>Validations :</strong></p>
<ul>
    <li>Username unique</li>
    <li>Mot de passe haché avec <code>password_hash()</code></li>
    <li>Email valide (optionnel)</li>
</ul>

<h3>4.2 Gestion des sondages</h3>

<h4><code>POST /php/create_survey.php</code></h4>
<p>Crée un nouveau sondage avec ses questions.</p>

<p><strong>Requête :</strong></p>
<pre><code>{
  "user_id": 1,
  "title": "Sondage test",
  "description": "Description du sondage",
  "questions": [
    {
      "text": "Quelle est votre couleur préférée ?",
      "type": "multiple",
      "anonymus": false,
      "options": ["Rouge", "Bleu", "Vert"]
    },
    {
      "text": "Notez notre service",
      "type": "scale",
      "anonymus": false
    }
  ]
}</code></pre>

<div class="info-box">
    <strong>Transaction SQL :</strong> L'insertion du formulaire, des questions et des options est effectuée dans une transaction pour garantir la cohérence. En cas d'erreur, un rollback est effectué.
</div>

<h4><code>GET /php/get_sondage.php?user_id=1</code></h4>
<p>Liste des sondages disponibles pour l'utilisateur.</p>

<p><strong>Filtrage automatique :</strong></p>
<ul>
    <li>Exclut les sondages déjà complétés par l'utilisateur</li>
    <li>Inclut les sondages partagés avec l'utilisateur</li>
</ul>

<h4><code>GET /php/get_questions.php?form_id=5</code></h4>
<p>Questions d'un sondage spécifique avec leurs options.</p>

<p><strong>Réponse :</strong></p>
<pre><code>[
  {
    "id": 12,
    "question_text": "Quelle est votre couleur préférée ?",
    "type": "multiple",
    "anonymus": 0,
    "options": ["Rouge", "Bleu", "Vert"]
  },
  {
    "id": 13,
    "question_text": "Notez notre service",
    "type": "scale",
    "anonymus": 0,
    "options": []
  }
]</code></pre>

<h4><code>DELETE /php/delete_survey.php</code></h4>
<p>Supprime un sondage (propriétaire uniquement).</p>

<div class="info-box">
    <strong>Vérification :</strong> L'utilisateur doit être le propriétaire. La suppression est en cascade (questions, options, réponses).
</div>

<h3>4.3 Réponses</h3>

<h4><code>POST /php/save_answer.php</code></h4>
<p>Enregistre une réponse à une question.</p>

<p><strong>Requête :</strong></p>
<pre><code>{
  "question_id": 12,
  "answer_text": "Rouge, Bleu",
  "user_id": 1
}</code></pre>

<h4><code>GET /php/get_answer.php?form_id=5&user_id=1</code></h4>
<p>Récupère toutes les réponses d'un sondage.</p>

<div class="info-box">
    <strong>Sécurité :</strong>
    <ul>
        <li>Seul le propriétaire peut voir les résultats</li>
        <li>Les réponses anonymes masquent le username</li>
    </ul>
</div>

<h3>4.4 Partage</h3>

<h4><code>POST /php/share_survey.php</code></h4>
<p>Partage un sondage avec un utilisateur.</p>

<h4><code>GET /php/get_survey_access.php</code></h4>
<p>Liste des utilisateurs ayant accès au sondage.</p>

<h4><code>POST /php/delete_survey_access.php</code></h4>
<p>Révoque l'accès d'un utilisateur.</p>

<h4><code>GET /php/list_forms_owned.php</code></h4>
<p>Sondages créés par l'utilisateur (pour le partage).</p>

<div class="section-divider"></div>

<h2 id="frontend">5. Frontend</h2>

<h3>5.1 Authentification</h3>

<p><strong>Flux de connexion :</strong></p>
<ol>
    <li>L'utilisateur saisit username/password</li>
    <li>Envoi POST vers <code>login_check.php</code></li>
    <li>Stockage du <code>user_id</code> dans <code>localStorage</code></li>
    <li>Redirection vers <code>home.html</code></li>
</ol>

<p><strong>Code clé :</strong></p>
<pre><code>const response = await fetch('http://localhost/google-form/php/login_check.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
});
const result = await response.json();
if (result.success) {
    localStorage.setItem('user_id', result.user.id);
    window.location.href = 'home.html';
}</code></pre>

<h3>5.2 Navbar dynamique</h3>

<p><strong>Logique :</strong></p>
<ul>
    <li>Si <code>user_id</code> existe dans localStorage → afficher "Create", "Logout"</li>
    <li>Sinon → afficher "Register", "Login"</li>
</ul>

<h3>5.3 Création de sondages</h3>

<p><strong>Fonctionnalités :</strong></p>
<ul>
    <li>Ajout dynamique de questions</li>
    <li>Sélection du type (text/multiple/scale)</li>
    <li>Ajout automatique d'options pour les choix multiples</li>
    <li>Checkbox "Rendre anonyme"</li>
</ul>

<p><strong>Gestion dynamique des inputs :</strong></p>
<pre><code>function checkAndAddQuestionBlock() {
    const emptyQuestions = Array.from(allQuestions)
        .filter(input => input.value.trim() === '');
    
    if (emptyQuestions.length === 1) {
        // Créer un nouveau bloc de question
    }
}</code></pre>

<h3>5.4 Répondre aux questions</h3>

<p><strong>Affichage dynamique selon le type :</strong></p>

<h4>Type <code>text</code> :</h4>
<pre><code>const textarea = document.createElement('textarea');
textarea.className = 'form-control mt-2';
textarea.rows = 3;</code></pre>

<h4>Type <code>multiple</code> :</h4>
<pre><code>q.options.forEach((option, index) => {
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.value = option;
});</code></pre>

<h4>Type <code>scale</code> :</h4>
<pre><code>for (let i = 0; i <= 10; i++) {
    const btn = document.createElement('button');
    btn.className = 'btn btn-outline-primary scale-btn';
    btn.textContent = i;
    btn.addEventListener('click', function() {
        this.classList.add('active', 'btn-primary');
    });
}</code></pre>

<h3>5.5 Visualisation des résultats</h3>

<h4>Graphiques avec Chart.js</h4>

<p><strong>Camembert (type <code>multiple</code>) :</strong></p>
<pre><code>function createPieChart(canvasId, answers) {
    const answerCounts = {};
    answers.forEach(answer => {
        // Séparer les réponses multiples
        const options = answer.answer_text.split(',').map(opt => opt.trim());
        options.forEach(option => {
            answerCounts[option] = (answerCounts[option] || 0) + 1;
        });
    });
    
    new Chart(canvas, {
        type: 'pie',
        data: {
            labels: Object.keys(answerCounts),
            datasets: [{
                data: Object.values(answerCounts)
            }]
        }
    });
}</code></pre>

<p><strong>Moyenne (type <code>scale</code>) :</strong></p>
<pre><code>if (question.type === 'scale') {
    const values = filteredAnswers
        .map(a => parseFloat(a.answer_text))
        .filter(v => !isNaN(v));
    const average = (values.reduce((sum, v) => sum + v, 0) / values.length).toFixed(2);
    // Affichage : "Moyenne : 7.45 / 10 (15 réponses)"
}</code></pre>

<h4>Export CSV</h4>
<pre><code>function downloadCSV() {
    // Ajouter le BOM UTF-8 pour Excel
    let csv = '\uFEFF' + `Sondage: ${formTitle}\n\n`;
    
    questions.forEach(q => {
        csv += `Question: ${q.question_text}\n`;
        csv += `Utilisateur,Réponse,Date\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    // Téléchargement
}</code></pre>

<div class="info-box">
    <strong>BOM UTF-8 :</strong> Le caractère <code>\uFEFF</code> au début du fichier CSV assure une correcte reconnaissance de l'encodage UTF-8 par Excel et autres applications.
</div>

<h4>Export PDF</h4>
<pre><code>function downloadPDF() {
    html2pdf().set({
        filename: `Rapport ${formTitle}.pdf`,
        jsPDF: { format: 'a4' }
    }).from(html).save();
}</code></pre>

<div class="section-divider"></div>

<h2 id="securite">6. Sécurité</h2>

<h3>6.1 Authentification</h3>

<h4>Hachage des mots de passe</h4>
<pre><code>// Inscription
$hashedPassword = password_hash($password, PASSWORD_DEFAULT);

// Connexion
if (password_verify($password, $hashedPasswordFromDB)) {
    // Authentifié
}</code></pre>

<h4>Protection anti-bruteforce</h4>
<pre><code>$stmt = $pdo->prepare("SELECT * FROM login_attempts WHERE ip = ?");
$stmt->execute([$ip]);
$attempt = $stmt->fetch();

if ($attempt && $attempt['attempts'] >= 5) {
    $lockedUntil = new DateTime($attempt['locked_until']);
    if ($lockedUntil > new DateTime()) {
        echo json_encode(['success' => false, 'error' => 'Trop de tentatives']);
        exit;
    }
}</code></pre>

<h3>6.2 Injection SQL</h3>

<div class="info-box">
    <strong>Vulnérable :</strong>
    <pre><code>$query = "SELECT * FROM user WHERE username = '$username'";</code></pre>
</div>

<div class="info-box">
    <strong>Sécurisé :</strong>
    <pre><code>$stmt = $pdo->prepare("SELECT * FROM user WHERE username = ?");
$stmt->execute([$username]);</code></pre>
</div>

<h3>6.3 Validation des données</h3>

<h4>Côté serveur (PHP)</h4>
<pre><code>// Vérifier que l'utilisateur existe
if (!isset($_POST['user_id']) || empty($_POST['user_id'])) {
    http_response_code(400);
    echo json_encode(['error' => 'user_id manquant']);
    exit;
}

// Vérifier la propriété
$stmt = $pdo->prepare("SELECT user_id FROM form WHERE id = ?");
$stmt->execute([$form_id]);
$form = $stmt->fetch();
if ($form['user_id'] != $user_id) {
    http_response_code(403);
    echo json_encode(['error' => 'Accès refusé']);
    exit;
}</code></pre>

<h3>6.4 Headers CORS</h3>
<pre><code>header('Content-Type: application/json');
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Methods: GET, POST, DELETE');
header('Access-Control-Allow-Headers: Content-Type');</code></pre>

<h3>6.5 Transactions SQL</h3>
<pre><code>try {
    $pdo->beginTransaction();
    
    // Insertion du formulaire
    $stmt = $pdo->prepare("INSERT INTO form (title, description, user_id) VALUES (?, ?, ?)");
    $stmt->execute([$title, $description, $user_id]);
    
    // Insertion des questions...
    
    $pdo->commit();
} catch (Exception $e) {
    $pdo->rollBack();
    echo json_encode(['success' => false, 'error' => 'Erreur serveur']);
}</code></pre>

<div class="section-divider"></div>

<h2 id="installation">7. Installation & Configuration</h2>

<h3>Prérequis</h3>
<ul>
    <li>PHP 8.0+</li>
    <li>MySQL/MariaDB 10.4+</li>
    <li>Serveur web (Apache/Nginx)</li>
    <li>Extension PHP PDO_MYSQL</li>
</ul>

<h3>Installation</h3>

<h4>1. Cloner le projet</h4>
<pre><code>git clone &lt;repository-url&gt;
cd google-form</code></pre>

<h4>2. Importer la base de données</h4>
<pre><code>mysql -u root -p &lt; sql/google-form.sql</code></pre>

<h4>3. Configurer la connexion MySQL</h4>
<p>Modifier les fichiers PHP (<code>php/*.php</code>) si nécessaire :</p>
<pre><code>$host = '127.0.0.1';
$db = 'google-form';
$user = 'root';
$password = '';</code></pre>

<h4>4. Démarrer le serveur</h4>
<pre><code># Avec XAMPP : démarrer Apache et MySQL
# Ou avec PHP built-in server :
php -S localhost:8000</code></pre>

<h4>5. Accéder à l'application</h4>
<pre><code>http://localhost/google-form/html/index.html</code></pre>

<h3>Configuration de production</h3>

<h4>1. Variables d'environnement</h4>
<pre><code>&lt;?php
define('DB_HOST', getenv('DB_HOST'));
define('DB_NAME', getenv('DB_NAME'));
define('DB_USER', getenv('DB_USER'));
define('DB_PASS', getenv('DB_PASS'));</code></pre>

<h4>2. Désactiver les erreurs PHP</h4>
<pre><code>ini_set('display_errors', 0);
error_reporting(0);</code></pre>

<h4>3. Sécurité des headers</h4>
<pre><code>header('X-Frame-Options: DENY');
header('X-Content-Type-Options: nosniff');
header('X-XSS-Protection: 1; mode=block');</code></pre>

<div class="section-divider"></div>

<h2 id="flux-donnees">8. Flux de données</h2>

<h3>8.1 Création d'un sondage</h3>

<div class="diagram">
<pre>┌──────────┐      ┌──────────────┐      ┌──────────┐      ┌──────────┐
│ Client   │      │ create_      │      │ PHP      │      │ MySQL    │
│ (JS)     │      │ survey.js    │      │ Backend  │      │          │
└──────────┘      └──────────────┘      └──────────┘      └──────────┘
     │                    │                    │                 │
     │ 1. Remplir form    │                    │                 │
     │───────────────────>│                    │                 │
     │                    │                    │                 │
     │                    │ 2. POST JSON       │                 │
     │                    │───────────────────>│                 │
     │                    │                    │                 │
     │                    │                    │ 3. BEGIN TRANS  │
     │                    │                    │────────────────>│
     │                    │                    │                 │
     │                    │                    │ 4. INSERT form  │
     │                    │                    │────────────────>│
     │                    │                    │                 │
     │                    │                    │ 5. INSERT quest.│
     │                    │                    │────────────────>│
     │                    │                    │                 │
     │                    │                    │ 6. COMMIT       │
     │                    │                    │────────────────>│
     │                    │                    │                 │
     │ 7. Redirect home   │                    │                 │
     │<───────────────────│                    │                 │</pre>
</div>

<h3>8.2 Répondre à un sondage</h3>

<div class="diagram">
<pre>┌──────────┐      ┌──────────────┐      ┌──────────┐      ┌──────────┐
│ Client   │      │ questions.js │      │ PHP      │      │ MySQL    │
└──────────┘      └──────────────┘      └──────────┘      └──────────┘
     │                    │                    │                 │
     │ 1. Fetch questions │                    │                 │
     │───────────────────>│                    │                 │
     │                    │                    │                 │
     │                    │ 2. GET questions   │                 │
     │                    │───────────────────>│                 │
     │                    │                    │                 │
     │                    │                    │ 3. SELECT       │
     │                    │                    │────────────────>│
     │                    │                    │                 │
     │ 4. Render inputs   │                    │                 │
     │<───────────────────│                    │                 │
     │                    │                    │                 │
     │ 5. Submit answers  │                    │                 │
     │───────────────────>│                    │                 │
     │                    │                    │                 │
     │                    │ 6. POST answers    │                 │
     │                    │───────────────────>│                 │
     │                    │                    │ 7. INSERT       │
     │                    │                    │────────────────>│</pre>
</div>

<div class="section-divider"></div>

<h2 id="guide-dev">9. Guide de développement</h2>

<h3>Ajouter un nouveau type de question</h3>

<h4>1. Frontend - Création (<code>create_survey.html</code>)</h4>
<pre><code>&lt;select class="form-select mb-2 question-type"&gt;
    &lt;option value="text"&gt;Texte libre&lt;/option&gt;
    &lt;option value="multiple"&gt;Choix multiple&lt;/option&gt;
    &lt;option value="scale"&gt;Échelle (0-10)&lt;/option&gt;
    &lt;option value="nouveau_type"&gt;Nouveau type&lt;/option&gt;
&lt;/select&gt;</code></pre>

<h4>2. Frontend - Affichage (<code>questions.js</code>)</h4>
<pre><code>if (q.type === 'nouveau_type') {
    // Créer l'interface pour ce type
    const customInput = document.createElement('input');
    customInput.type = 'date';
    customInput.setAttribute('data-question-id', q.id);
    li.appendChild(customInput);
}</code></pre>

<h4>3. Frontend - Visualisation (<code>answer.js</code>)</h4>
<pre><code>if (question.type === 'nouveau_type') {
    // Afficher un graphique spécifique
}</code></pre>

<h3>Tests manuels</h3>

<h4>1. Créer un compte test</h4>
<ul>
    <li>Username: test_user</li>
    <li>Password: Test123!</li>
    <li>Email: test@example.com</li>
</ul>

<h4>2. Créer un sondage de test</h4>
<ul>
    <li>Titre: "Test Sondage"</li>
    <li>Question 1 (text): "Commentaires ?"</li>
    <li>Question 2 (multiple): "Couleur ?" → Options: Rouge, Vert, Bleu</li>
    <li>Question 3 (scale): "Note ?"</li>
</ul>

<h4>3. Répondre au sondage</h4>
<ul>
    <li>Se connecter avec un autre compte</li>
    <li>Répondre aux questions</li>
    <li>Vérifier l'enregistrement</li>
</ul>

<h4>4. Visualiser les résultats</h4>
<ul>
    <li>Se reconnecter avec le compte créateur</li>
    <li>Ouvrir la page Answer</li>
    <li>Vérifier les graphiques et statistiques</li>
</ul>

<h3>Maintenance</h3>

<h4>Sauvegarde de la base de données</h4>
<pre><code>mysqldump -u root -p google-form &gt; backup_$(date +%Y%m%d).sql</code></pre>

<h4>Nettoyage des tentatives de connexion</h4>
<pre><code>DELETE FROM login_attempts 
WHERE last_attempt &lt; DATE_SUB(NOW(), INTERVAL 1 DAY);</code></pre>

<h4>Analyse des performances</h4>
<pre><code>-- Sondages les plus populaires
SELECT f.title, COUNT(DISTINCT a.user_id) as nb_participants
FROM form f
JOIN question q ON f.id = q.form_id
JOIN answer a ON q.id = a.question_id
GROUP BY f.id
ORDER BY nb_participants DESC;</code></pre>

<div class="section-divider"></div>

<h2>Limites actuelles & Améliorations futures</h2>

<h3>Limites</h3>
<ul>
    <li>Pas de gestion de sessions PHP (utilise localStorage côté client)</li>
    <li>Pas de limite sur le nombre de questions par sondage</li>
    <li>Pas de pagination pour les longues listes de réponses</li>
    <li>Pas de système de notification</li>
</ul>

<h3>Améliorations possibles</h3>
<ol>
    <li><strong>Système de rôles</strong> : Admin, Créateur, Répondant</li>
    <li><strong>Questions conditionnelles</strong> : Afficher Q2 seulement si réponse Q1 = "Oui"</li>
    <li><strong>Templates de sondages</strong> : Modèles prédéfinis</li>
    <li><strong>Analytics avancés</strong> : Tableau de bord avec statistiques</li>
    <li><strong>API RESTful</strong> : Restructuration complète en REST</li>
    <li><strong>Websockets</strong> : Résultats en temps réel</li>
    <li><strong>Import/Export</strong> : Importer des questions depuis Excel</li>
    <li><strong>Thèmes personnalisables</strong> : Dark mode, couleurs</li>
    <li><strong>Multi-langue</strong> : i18n</li>
    <li><strong>Mobile app</strong> : Application React Native</li>
</ol>

<div class="section-divider"></div>

<div class="info-box" style="text-align: center; margin-top: 50px;">
    <h3>Fin de la documentation</h3>
    <p><strong>Version :</strong> 1.0.0 | <strong>Date :</strong> 29 décembre 2025</p>
</div>

</body>
</html>